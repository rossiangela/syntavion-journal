name: Publish to Zenodo and Deploy Site

on:
  workflow_dispatch:
    inputs:
      paper_path:
        description: 'Path to paper (e.g. papers/2025/001-example)'
        required: true
        default: 'papers/2025/001-example'

jobs:
  publish:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write
      id-token: write

    steps:
      - name: Checkout code (clean)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Ottieni tutto lo storico per verificare i workflow

      - name: Find deprecated actions
        run: |
          echo "### Checking for deprecated actions ###"
          grep -r "upload-artifact@v3" .github/ || echo "No v3 references found"
          echo "### All action versions ###"
          find .github -name "*.yml" -exec grep -l "uses:" {} \; | xargs grep -h "uses:"

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies (clean)
        run: |
          python -m pip install --upgrade pip
          pip install pyyaml requests jinja2 markdown --no-cache-dir
          pip list

      # [Altri steps rimangono identici...]

      - name: Upload Pages Artifact (clean)
        uses: actions/upload-pages-artifact@v3
        with:
          path: '_site'
          retention-days: 1  # Riduci la retention per debug

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v2
